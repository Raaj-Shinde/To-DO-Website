<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Todo — Dark Minimal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body{height:100%}
    body{font-size:16px;line-height:1.45}
    /* subtle input focus */
    .glass{background:rgba(255,255,255,0.02)}
  </style>
</head>
<body class="min-h-screen bg-[#0b1220] text-slate-100 p-6 flex items-start justify-center">
  <div class="w-full max-w-2xl">
    <header class="mb-4">
      <h1 class="text-xl font-medium">Todo</h1>
    </header>

    <main class="bg-[#071022] glass rounded-xl p-4 shadow-lg border border-zinc-800">
      <div class="flex gap-3 items-center">
        <input id="task" class="flex-1 rounded-md px-3 py-2 bg-transparent border border-zinc-700 placeholder-zinc-500 text-base" placeholder="Add a task" />
        <button id="addBtn" class="px-3 py-2 bg-violet-600 rounded-md text-sm">Add</button>
        <button id="clearBtn" class="px-3 py-2 border border-zinc-700 rounded-md text-sm">Clear</button>
      </div>

      <div id="sections" class="mt-4 space-y-3"></div>
      <div id="emptyMsg" class="mt-4 text-center text-zinc-400">No tasks</div>
    </main>

    <footer class="mt-3 text-center text-zinc-500 text-sm">Saved locally</footer>
  </div>

<script>
(function(){
  const STORAGE_KEY = 'daily_todo_v1'
  const $ = id => document.getElementById(id)
  const fmtDateKey = d => d.toISOString().slice(0,10)
  const fmtFriendlyDate = iso => new Date(iso).toLocaleDateString(undefined, {weekday:'short', month:'short', day:'numeric', year:'numeric'})
  const fmtTime = iso => new Date(iso).toLocaleTimeString(undefined, {hour:'2-digit',minute:'2-digit'})

  function loadAll(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}') }catch(e){ console.warn('load error', e); return {} } }
  function saveAll(obj){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)) }catch(e){ console.warn('save error', e) } }

  function addTask(text){ if(!text || !text.trim()) return; const now = new Date(); const key = fmtDateKey(now); const store = loadAll(); store[key] = store[key] || []; store[key].push({ id: Date.now().toString(36), text: text.trim(), createdAt: now.toISOString(), done:false }); saveAll(store); render(); }
  function toggleDone(dateKey, id){ const store = loadAll(); const arr = store[dateKey]; if(!arr) return; const it = arr.find(x=>x.id===id); if(it) it.done = !it.done; saveAll(store); render(); }
  function deleteTask(dateKey, id){ const store = loadAll(); if(!store[dateKey]) return; store[dateKey] = store[dateKey].filter(x=>x.id!==id); if(store[dateKey].length===0) delete store[dateKey]; saveAll(store); render(); }
  function clearAll(){ if(confirm('Clear all tasks?')){ localStorage.removeItem(STORAGE_KEY); render() } }

  function render(){
    const sections = $('sections'); sections.innerHTML = ''
    const store = loadAll(); const keys = Object.keys(store).sort((a,b)=> b.localeCompare(a))
    if(keys.length === 0){ $('emptyMsg').style.display = 'block'; return } else { $('emptyMsg').style.display = 'none' }

    keys.forEach(key => {
      const container = document.createElement('section'); container.className = 'bg-[#061118] rounded-md p-3 border border-zinc-800'
      const header = document.createElement('div'); header.className = 'flex items-center justify-between mb-3'
      const left = document.createElement('div'); left.innerHTML = `<div class="text-sm font-medium">${fmtFriendlyDate(key)}</div><div class="text-xs text-zinc-500">${key}</div>`
      const right = document.createElement('div'); right.className = 'text-xs text-zinc-500'; right.textContent = `${store[key].length} items`
      header.appendChild(left); header.appendChild(right); container.appendChild(header)

      const ul = document.createElement('ul'); ul.className = 'space-y-2'
      store[key].forEach(item => {
        const li = document.createElement('li'); li.className = 'flex items-center justify-between p-2 rounded-md bg-[#071422] border border-zinc-800'
        const left = document.createElement('div'); left.className = 'flex items-center gap-3'
        const chk = document.createElement('button'); chk.className = 'w-8 h-8 rounded-md flex items-center justify-center border border-zinc-700'; chk.onclick = ()=>toggleDone(key, item.id)
        chk.innerHTML = item.done ? '✓' : ''
        const txt = document.createElement('div'); txt.innerHTML = `<div class="text-base ${item.done ? 'line-through text-zinc-500':''}">${escapeHtml(item.text)}</div><div class="text-xs text-zinc-500">${fmtTime(item.createdAt)} · ${(new Date(item.createdAt)).toLocaleDateString()}</div>`
        left.appendChild(chk); left.appendChild(txt)

        const actions = document.createElement('div'); actions.className = 'flex gap-2'
        const del = document.createElement('button'); del.className = 'px-2 py-1 text-xs rounded-md border border-zinc-700'; del.textContent='Delete'; del.onclick = ()=>{ if(confirm('Delete?')) deleteTask(key, item.id) }
        actions.appendChild(del)

        li.appendChild(left); li.appendChild(actions); ul.appendChild(li)
      })

      container.appendChild(ul); sections.appendChild(container)
    })
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m] }) }

  // events
  $('addBtn').addEventListener('click', ()=>{ addTask($('task').value); $('task').value = ''; $('task').focus() })
  $('task').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); $('addBtn').click() } })
  $('clearBtn').addEventListener('click', clearAll)

  // initial
  render()

  // midnight re-render to show new day sections when day changes
  ;(function midnightRerender(){ const now = new Date(); const next = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1, 0,0,1); const delay = next - now; setTimeout(()=>{ render(); midnightRerender() }, delay) })()

})();
</script>
</body>
</html>
