<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Todo — Dark Minimal (Responsive)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body{height:100%}
    body{font-size:16px;line-height:1.45}
    /* tiny visual polish */
    .glass{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-[#07101a] to-[#081422] text-slate-100 p-4 sm:p-6 flex items-start justify-center">
  <div class="w-full max-w-2xl">
    <header class="mb-4 flex items-center justify-between">
      <h1 class="text-lg font-medium">Todo</h1>
      <div id="clock" class="text-sm text-slate-400 hidden sm:block"></div>
    </header>

    <main class="glass rounded-xl p-4 shadow-lg border border-slate-800">
      <!-- responsive form: stacked on mobile, inline on wider -->
      <div class="flex flex-col sm:flex-row gap-3 items-stretch">
        <input id="task" class="flex-1 rounded-md px-4 py-3 bg-[#031018] border border-slate-700 placeholder-slate-500 text-base focus:outline-none focus:ring-2 focus:ring-violet-500" placeholder="Add a task" />
        <div class="flex gap-2 sm:flex-col md:flex-row">
          <button id="addBtn" class="w-full sm:w-36 px-4 py-3 bg-violet-600 hover:bg-violet-500 rounded-md text-sm font-medium">Add</button>
          <button id="clearBtn" class="w-full sm:w-36 px-4 py-3 border border-slate-700 rounded-md text-sm">Clear</button>
        </div>
      </div>

      <div id="sections" class="mt-4 space-y-3"></div>
      <div id="emptyMsg" class="mt-4 text-center text-slate-400">No tasks</div>
    </main>

    <footer class="mt-3 text-center text-slate-400 text-sm">Saved locally • Dark mode</footer>
  </div>

<script>
(function(){
  const STORAGE_KEY = 'daily_todo_v1'
  const $ = id => document.getElementById(id)
  const fmtDateKey = d => d.toISOString().slice(0,10)
  const fmtFriendlyDate = iso => new Date(iso).toLocaleDateString(undefined, {weekday:'short', month:'short', day:'numeric', year:'numeric'})
  const fmtTime = iso => new Date(iso).toLocaleTimeString(undefined, {hour:'2-digit',minute:'2-digit'})

  // clock (small and unobtrusive) - shows only on sm+
  function startClock(){ const el = $('clock'); if(!el) return; function tick(){ const now = new Date(); el.textContent = now.toLocaleString(undefined, {weekday:'short', month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'}) } tick(); setInterval(tick, 1000) }

  function loadAll(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}') }catch(e){ console.warn('load error', e); return {} } }
  function saveAll(obj){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)) }catch(e){ console.warn('save error', e) } }

  function addTask(text){ if(!text || !text.trim()) return; const now = new Date(); const key = fmtDateKey(now); const store = loadAll(); store[key] = store[key] || []; store[key].push({ id: Date.now().toString(36), text: text.trim(), createdAt: now.toISOString(), done:false }); saveAll(store); render(); }
  function toggleDone(dateKey, id){ const store = loadAll(); const arr = store[dateKey]; if(!arr) return; const it = arr.find(x=>x.id===id); if(it) it.done = !it.done; saveAll(store); render(); }
  function deleteTask(dateKey, id){ const store = loadAll(); if(!store[dateKey]) return; store[dateKey] = store[dateKey].filter(x=>x.id!==id); if(store[dateKey].length===0) delete store[dateKey]; saveAll(store); render(); }
  function clearAll(){ if(confirm('Clear all tasks?')){ localStorage.removeItem(STORAGE_KEY); render() } }

  function render(){
    const sections = $('sections'); sections.innerHTML = ''
    const store = loadAll(); const keys = Object.keys(store).sort((a,b)=> b.localeCompare(a))
    if(keys.length === 0){ $('emptyMsg').style.display = 'block'; return } else { $('emptyMsg').style.display = 'none' }

    keys.forEach(key => {
      const container = document.createElement('section'); container.className = 'bg-[#04151a] rounded-md p-3 border border-slate-800'
      const header = document.createElement('div'); header.className = 'flex items-center justify-between mb-3'
      const left = document.createElement('div'); left.innerHTML = `<div class="text-sm font-medium text-slate-100">${fmtFriendlyDate(key)}</div><div class="text-xs text-slate-500">${key}</div>`
      const right = document.createElement('div'); right.className = 'text-xs text-slate-500'; right.textContent = `${store[key].length} items`
      header.appendChild(left); header.appendChild(right); container.appendChild(header)

      const ul = document.createElement('ul'); ul.className = 'space-y-2'
      store[key].forEach(item => {
        const li = document.createElement('li'); li.className = 'flex items-center justify-between p-2 rounded-md bg-[#041a20] border border-slate-800'
        const left = document.createElement('div'); left.className = 'flex items-center gap-3'
        const chk = document.createElement('button'); chk.className = 'w-10 h-10 rounded-md flex items-center justify-center border border-slate-700 text-slate-100 text-lg'; chk.onclick = ()=>toggleDone(key, item.id)
        chk.setAttribute('aria-label', item.done? 'Unmark done' : 'Mark done')
        chk.innerHTML = item.done ? '✓' : ''
        const txt = document.createElement('div'); txt.innerHTML = `<div class="text-base ${item.done ? 'line-through text-slate-500':''}" style="word-break:break-word">${escapeHtml(item.text)}</div><div class="text-xs text-slate-500">${fmtTime(item.createdAt)} · ${(new Date(item.createdAt)).toLocaleDateString()}</div>`
        left.appendChild(chk); left.appendChild(txt)

        const actions = document.createElement('div'); actions.className = 'flex gap-2 items-center'
        const del = document.createElement('button'); del.className = 'px-3 py-2 text-sm rounded-md border border-slate-700'; del.textContent='Delete'; del.onclick = ()=>{ if(confirm('Delete?')) deleteTask(key, item.id) }
        actions.appendChild(del)

        li.appendChild(left); li.appendChild(actions); ul.appendChild(li)
      })

      container.appendChild(ul); sections.appendChild(container)
    })
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m] }) }

  // events
  $('addBtn').addEventListener('click', ()=>{ addTask($('task').value); $('task').value = ''; $('task').focus() })
  $('task').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); $('addBtn').click() } })
  $('clearBtn').addEventListener('click', clearAll)

  // initial
  startClock(); render()

  // midnight re-render to show new day sections when day changes
  ;(function midnightRerender(){ const now = new Date(); const next = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1, 0,0,1); const delay = next - now; setTimeout(()=>{ render(); midnightRerender() }, delay) })()

})();
</script>
</body>
</html>
